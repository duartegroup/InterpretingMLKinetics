# Interpreting ML kinetics

This repository contains the data, code, and trained models for the work entitled "Kinetic predictions for SN2 reactions using the BERT architecture: Comparison and interpretation". 

<img width="1109" alt="image" src="https://github.com/C-Wils/InterpretingMLKinetics/assets/88711576/ad528e27-c8ca-4b3c-85f1-096ad9361106">

## Python versions and libraries

Code for training and evaluation of the BERT model, and calculation of Integrated Gradients, was tested using Python version 3.6.13 and the following libraries: pandas, numpy, scipy, rdkit, regex, openpyxl, scikit-learn, transformers, torch, datasets, python-dotenv, ax-platform and captum (versions specified in ./Scripts/Training_and_evaluation/BERT/requirements.txt).

All other code was tested using Python version 3.9.12 and the following libraries: pandas, numpy, scipy, matplotlib, rdkit, regex, scikit-learn, CIMtools, CGRtools, treeinterpreter and pywaffle (versions specified in ./requirements.txt).

### Data
This folder contains three sub-directories, with each containing the data and results for the DFT and ML calculations: "DFT", "ML_analysis_and_results" and "ML_datasets". The files that are contained within each of these sub-directories are as follows: 

#### DFT

* Input and output files from DFT calculations that were executed using the autodE interface: "autodE_inps" and "autodE_outs"

* Input and output files from DFT caculations that were executed without using the autodE interface: "ORCA_*species*_*calculation_type*_inps" and "ORCA_<species>_<calculation_type>_outs"

* Output code from frequency shift calculations in OTherm: "OTherm_outs"

* The DFT dataset: "Data_for_dft.xlsx"

* Rotational symmetry numbers of species whos thermochemistry was calculated without using the autodE interface: "<species>_symmetry_numbers.csv"

* Summary of the main results from DFT calculations that were executed without using the autodE interface: "Iteration_of_DFT_outs.xlsx"
  
#### ML_datasets 

This subdirectory contains the input data for each of the trained ML models. "Input_data_<dataset_name>.xlsx" is the raw dataset with reactions in SMILES format, solvent names in text format, and logk, temperature, solvent mole fractions, and ionic strength in float format. "Total_test_processed.xlsx" is the total test data with SMILES of each species in the reaction separated into their own columns, and "Total_train_unstandardized_isida.xlsx" is the unstandardized ISIDA fragment representation of the total train data. Model inputs are provided in the following folders:

* Datasets in .rdf format for input into the RF training scripts: "rdfs"

* Cross-validation folds of datasets featurized for the RF model, generated by the RF training scripts: "RF_cv_splits"

* Cross-validation folds of datasets featurized for the BERT model: "BERT"

* Input data for the RF model trained on reaction center ISIDA fragments: "RF_rxn_center_only"

#### ML_analysis_and_results

This subdirectory contains three folders: "RF", "BERT", and "General". 

"General" contains the data relevant to the analysis of both RF and BERT:

  * Input/output files and results for atom mapping calculations carried out on the reactions in the test data: "Atom_mapping"

  * Results from reaction center substructure matching to the representative examples of LG, steric, nucleophilic, and allylic effects: "Representative examples"

"RF" and "BERT" both have the following structure:

* Data and results from interpreting model predictions: "<BERT/RF>_interpretation"
  
* Data and results for representative examples of LG, steric, nucleophilic, and allylic effects: "<BERT/RF>_representative_examples"

*  Results from training and evaluating the models: "<BERT/RF>_training_and_evaluation"

"RF" also contains the folder "Rxn_center_only" which countains the data and results from training, evaluating, and interpreting the RF model trained on reaction center ISIDA fragments . 


### Scripts

This folder contains three sub-directories, with each containing python scripts for training, evaluation, and interpretation of the RF and BERT models (including general utilities): "Training_and_evaluation", "Interpretation" and "Utils". The files that are contained within each of these sub-directories are as follows: 

#### Training and evaluation

* Python scripts for training and evaluating the BERT and RF models, and the RF model trained on reaction center ISIDA fragments: "BERT", "RF", and "RF_rxn_center_only", respectively

* Example python script for plotting the learning curves

#### Interpretation

* Python scripts for interpreting predictions made by the BERT and RF models: "BERT" and "RF"
  
* Python scripts relevant to interpreting predictions made by both the BERT and RF models: "General"

#### Utils

* Example python script for checking whether uncertainties associated with feature importances are uncorrelated

### Models

This subdirectory contains the trained ML models: 

* BERT model with the optimized hyperparameters: "BERT_best_hps"

* RF model trained on the data compiled by Madzhidov and co-workers (https://doi.org/10.1002/minf.201800104), after being cleaned in the current work: "RF_Madzhhidov_cleaned"

* RF model trained on the total train data: "RF_total_train"

* RF model trained on reaction center ISIDA fragments (and physical properties of solvent and temperature): "RF_rxn_center_only"  
